<style>
@import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap');

:root{
  --ivory:#FAF9F7; --blush:#EAD4D8; --silver:#C9CCD6;
  --ink:#1f1f1f; --muted:#5d5d5d;
  --shadow: 0 16px 44px rgba(0,0,0,.10);
}

html, body{ height:100%; overflow-x:hidden; }

.cmOB{
  width:100vw;
  margin-left:calc(50% - 50vw);
  margin-right:calc(50% - 50vw);
  min-height: 100vh;
  min-height: 100svh;
  min-height: 100dvh;
  display:grid;
  place-items:center;
  padding:28px 18px;
  background:
    radial-gradient(1200px 600px at 20% 0%, rgba(234,212,216,.55), transparent 60%),
    radial-gradient(900px 520px at 90% 10%, rgba(201,204,214,.55), transparent 55%),
    var(--ivory);
  font-family:"Libre Baskerville", Georgia, serif;
}

.cmOB-card{
  width:min(720px,100%);
  background:rgba(250,249,247,.90);
  border:1px solid rgba(31,31,31,.08);
  border-radius:26px;
  padding:26px;
  box-shadow:var(--shadow);
}

.cmOB-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:14px;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  font-size:13px;
  color: var(--muted);
}

.cmOB-bar{
  width:180px; height:8px; border-radius:999px;
  background: rgba(201,204,214,.35);
  overflow:hidden;
  border:1px solid rgba(31,31,31,.06);
}
.cmOB-bar > i{ display:block; width:66%; height:100%; background: rgba(216,167,177,.75); }

.cmOB h1{ margin: 10px 0 10px; font-size: clamp(26px, 3.6vw, 38px); line-height: 1.08; }

.cmOB-lead{
  margin:0 0 14px;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  color: var(--muted);
  font-size: 15.5px;
  line-height: 1.85;
  max-width: 62ch;
}

.cmOB label{
  display:block;
  margin: 0 0 8px;
  color: rgba(0,0,0,.72);
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  font-size: 13px;
}

.cmOB input{
  width:100%;
  padding:14px 14px;
  border-radius:16px;
  border:1px solid rgba(31,31,31,.12);
  background: rgba(250,249,247,.92);
  outline:none;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  font-size:16px;
}
.cmOB input:focus{
  border-color: rgba(216,167,177,.95);
  box-shadow: 0 0 0 4px rgba(216,167,177,.18);
}

.cmOB-btn{
  display:inline-flex; align-items:center; justify-content:center; gap: 10px;
  padding: 14px 18px; border-radius: 999px;
  border: 1px solid rgba(31,31,31,.10);
  cursor:pointer;
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
  font-weight: 650; letter-spacing:.2px; user-select:none; white-space:nowrap;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

.cmOB-primary{
  width:100%;
  margin-top:14px;
  padding:16px 22px;
  background: linear-gradient(180deg, rgba(216,167,177,.98), rgba(234,212,216,.90));
  color: rgba(31,31,31,.92);
  box-shadow: 0 14px 34px rgba(216,167,177,.30), 0 10px 26px rgba(0,0,0,.06);
}
.cmOB-primary:hover{
  filter: brightness(1.01);
  box-shadow: 0 18px 44px rgba(216,167,177,.40), 0 12px 30px rgba(0,0,0,.08);
}
.cmOB-btn:active{ transform: translateY(1px); }

.cmOB-secondary{
  background: rgba(255,255,255,.85);
  color: rgba(31,31,31,.75);
  border: 1px solid rgba(31,31,31,.15);
  box-shadow: 0 6px 16px rgba(0,0,0,.06);
  backdrop-filter: blur(6px);
}
.cmOB-secondary:hover{
  background: rgba(255,255,255,.95);
  color: rgba(31,31,31,.95);
  box-shadow: 0 10px 24px rgba(0,0,0,.10);
}

.cmOB-error{
  margin-top:12px;
  color:#8a2c2c;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  font-size:13px;
  display:none;
}
.cmOB-error.show{display:block;}

.cm-micro{
  margin-top:8px;
  text-align:center;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  font-size:12.5px;
  color: rgba(31,31,31,.55);
  letter-spacing:.2px;
}

/* Animations douces */
.cm-appear{ opacity:0; transform: translateY(12px); animation: cmFadeUp .8s ease forwards; }
.cm-delay-1{ animation-delay: .10s; }
.cm-delay-2{ animation-delay: .28s; }
.cm-delay-3{ animation-delay: .46s; }
@keyframes cmFadeUp{ to{ opacity:1; transform: translateY(0);} }
</style>

<div class="cmOB">
  <div class="cmOB-card">
    <div class="cmOB-top cm-appear cm-delay-1">
      <div style="display:flex;align-items:center;gap:10px;">
        <span>√âtape 2/3</span>
        <span class="cmOB-bar" aria-hidden="true"><i></i></span>
      </div>
      <button class="cmOB-btn cmOB-secondary" id="cmOB2Back" type="button">‚Üê Retour</button>
    </div>

    <h1 class="cm-appear cm-delay-2">On vous envoie votre lien priv√© üì©</h1>
    <p class="cmOB-lead cm-appear cm-delay-3">
      Votre carnet sera accessible via un <b>lien magique</b> (sans mot de passe).
      Comme √ßa, c‚Äôest simple, rassurant‚Ä¶ et vous pouvez y revenir quand vous voulez.
    </p>

    <div class="cm-appear cm-delay-3">
      <label for="cmOB2Email">Votre email</label>
      <input id="cmOB2Email" type="email" placeholder="vous@email.com" autocomplete="email" />
    </div>

    <button class="cmOB-btn cmOB-primary cm-appear cm-delay-3" id="cmOB2Next" type="button">
      Continuer
    </button>

    <div class="cm-micro cm-appear cm-delay-3">
      Aucun spam ¬∑ juste votre acc√®s ¬∑ en 2 minutes
    </div>

    <div class="cmOB-error" id="cmOB2Err">Email invalide.</div>
  </div>
</div>

<script>
(function(){
  const prevUrl = "/onboarding-1";
  const nextUrl = "/onboarding-3";

  const data = safeGet();
  if(!data.weddingDate || !data.prenom1 || !data.prenom2){
    window.location.href = prevUrl;
    return;
  }

  const backBtn = document.getElementById("cmOB2Back");
  const nextBtn = document.getElementById("cmOB2Next");
  const emailEl = document.getElementById("cmOB2Email");
  const errEl   = document.getElementById("cmOB2Err");

  if(data.email) emailEl.value = data.email;

  backBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    window.location.href = prevUrl;
  });

  function submit(){
    const v = (emailEl.value || "").trim();
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)){
      errEl.classList.add("show");
      return;
    }
    errEl.classList.remove("show");
    data.email = v.toLowerCase();
    safeSet(data);
    window.location.href = nextUrl;
  }

  nextBtn.addEventListener("click", submit);
  emailEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); submit(); } });

  function safeGet(){ try{ return JSON.parse(localStorage.getItem("cm_onboarding")||"{}"); }catch(e){ return {}; } }
  function safeSet(o){ try{ localStorage.setItem("cm_onboarding", JSON.stringify(o)); }catch(e){} }
})();
</script>
